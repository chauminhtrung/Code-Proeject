<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{/manager/index :: dynamic(~{::body})}">
<head>
  <meta charset="UTF-8">
  <title>Thêm Sản Phẩm</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
        rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
        crossorigin="anonymous">
  <link rel="stylesheet" href="/CSS/detail.css">
</head>
<body>
<div class="bg-white p-4 rounded m-4" style="height: 600px; width: 1200px">
  <form id="editProductDetails">
    <div class="row">
      <div class="col-6">
        <div class="form-outline mb-4 ms-3">
          <label class="form-label ms-2" for="fileInput">Hình ảnh</label>
          <input class="form-control border" id="fileInput" type="file" accept="image/*"/>
        </div>
        <div class="form-outline text-center bg-light rounded ms-3" style="max-width: 600px; height: 405px;">
          <img class="rounded" id="imagePreview" width="550" height="405" alt="Image Preview" />
        </div>
      </div>
      <div class="col-6">
        <div class="form-outline mb-2">
          <label class="form-label ms-2" for="name">Tên sản phẩm</label>
          <input type="text" id="name" class="form-control border"/>
        </div>

        <div class="form-outline mb-2">
          <label class="form-label ms-2" for="price">Giá</label>
          <input type="number" id="price" class="form-control border"/>
        </div>

        <div class="d-flex">
          <div class="form-outline mb-2 w-50">
            <label class="form-label ms-2" for="CategorydeId">ID Danh Mục</label>
            <select class="form-select border" aria-label="Default select example" id="CategorydeId">
              <option selected>Open this select menu</option>
            </select>
          </div>
          <div class="form-outline mb-2 w-50 ms-4">
            <label class="form-label ms-2" for="CategorydeName">Tên Danh Mục</label>
            <select class="form-select border" aria-label="Default select example" id="CategorydeName">
              <option selected>Open this select menu</option>
            </select>
          </div>
        </div>

        <div class="d-flex">
          <div class="form-outline mb-2 w-50">
            <label class="form-label ms-2" for="parentCategoryId">ID Danh Mục Cha</label>
            <select class="form-select border" aria-label="Default select example" id="parentCategoryId">
              <option selected>Open this select menu</option>
            </select>
          </div>
          <div class="form-outline mb-2 w-50 ms-4">
            <label class="form-label ms-2" for="parentCategoryName">Tên Danh Mục Cha</label>
            <select class="form-select border" aria-label="Default select example" id="parentCategoryName">
              <option selected>Open this select menu</option>
            </select>
          </div>
        </div>

        <div class="d-flex">
          <div class="form-outline mb-2 w-50">
            <label class="form-label ms-2" for="createDate">Ngày tạo</label>
            <input type="date" id="createDate" class="form-control border" />
          </div>
          <div class="form-outline mb-2 w-50 ms-4">
            <label class="form-label ms-2" for="qtyInput">Số lượng</label>
            <input type="number" id="qtyInput" class="form-control border"/>
          </div>
          <div class="ms-2 me-1">
            <label class="form-label ms-2 w-100" for="available">Available</label>
            <div class="form-check form-switch mode-switch mt-1 ms-2">
              <input class="form-check-input" type="checkbox" id="available">
            </div>
          </div>
        </div>
        <div class="form-outline mb-2">
          <label class="form-label ms-2" for="description">Mô tả</label>
          <textarea class="form-control border" id="description" rows="3"></textarea>
        </div>
        <button type="button" class="btn btn-primary" id="addProductBtn">Thêm sản phẩm</button>
        <button type="button" class="btn btn-secondary text-dark ms-2" onclick="resetFormWithConfirmation()" style="background-color: #e9f3ff;border-color: #e9f3ff">Làm mới</button>
      </div>
    </div>
  </form>
</div>

<script>
  // Hàm để gọi API và điền danh mục
  async function fillCategories() {
    try {
      const categoryResponse = await axios.get('/api-category/get-all-category');
      const categories = categoryResponse.data.data; // Lấy dữ liệu danh mục từ response

      // Điền danh sách categories vào form select
      const categoryIdSelect = document.getElementById('parentCategoryId');
      const categoryNameSelect = document.getElementById('parentCategoryName');
      categoryIdSelect.innerHTML = ''; // Xóa nội dung hiện tại
      categoryNameSelect.innerHTML = ''; // Xóa nội dung hiện tại

      categories.forEach(category => {
        const optionId = document.createElement('option');
        optionId.value = category.id; // Giá trị của option
        optionId.textContent = category.id; // Nội dung hiển thị cho ID
        categoryIdSelect.appendChild(optionId); // Thêm option vào select

        const optionName = document.createElement('option');
        optionName.value = category.id; // Giá trị của option
        optionName.textContent = category.name; // Nội dung hiển thị cho tên
        categoryNameSelect.appendChild(optionName); // Thêm option vào select
      });

      // Gọi API lấy danh sách category details (danh mục cha)
      const categoryDetailResponse = await axios.get('/api-category/get-all-categoryde');
      const categoryDetails = categoryDetailResponse.data.data; // Lấy dữ liệu danh mục con từ response

      // Điền danh sách category details vào form select
      const categorydeIdSelect = document.getElementById('CategorydeId');
      const categorydeNameSelect = document.getElementById('CategorydeName');
      categorydeIdSelect.innerHTML = ''; // Xóa nội dung hiện tại
      categorydeNameSelect.innerHTML = ''; // Xóa nội dung hiện tại

      categoryDetails.forEach(detail => {
        const optionId = document.createElement('option');
        optionId.value = detail.id; // Giá trị của option (ID của danh mục con)
        optionId.textContent = detail.id; // Nội dung hiển thị cho ID
        categorydeIdSelect.appendChild(optionId); // Thêm option vào select

        const optionName = document.createElement('option');
        optionName.value = detail.id; // Giá trị của option
        optionName.textContent = detail.name; // Nội dung hiển thị cho tên
        categorydeNameSelect.appendChild(optionName); // Thêm option vào select
      });

    } catch (error) {
      await Swal.fire({
        icon: 'error',
        title: 'Có lỗi xảy ra',
        text: 'Chi tiết lỗi: ' + error.message,
        confirmButtonText: 'Đồng ý'
      });
    }
  }
  // Gọi hàm khi trang được tải
  document.addEventListener('DOMContentLoaded', fillCategories);
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
<script src="/JS/productManager.js"></script>
</body>
</html>